---
interface Props {
  title: string;
  description: string;
  image?: string;
  type?: string;
  keywords?: string;
}

import SEO from "@/components/common/SEO.astro";
import JsonLD from "@/components/common/JsonLD.astro";
import CookieConsent from "@/components/common/CookieConsent.astro";
import PreviewIndicator from "@/components/common/PreviewIndicator.astro";
import { isPreviewEnabled } from "@/lib/contentful";
import "@/styles/main.css";
import "@phosphor-icons/web/regular";
import "@phosphor-icons/web/bold";
import "@phosphor-icons/web/duotone";
import "@phosphor-icons/web/fill";
import "@phosphor-icons/web/light";
import "@phosphor-icons/web/thin";

const { title, description, image, type, keywords } = Astro.props;

const GTM_ID = import.meta.env.PUBLIC_GTM_ID;
---

<!doctype html>
<html lang="es">
  <head>
    <SEO 
      title={title} 
      description={description} 
      image={image} 
      type={type} 
      keywords={keywords} 
    />
    <JsonLD />
    
    {/* GTM Script - Solo si existe ID */}

    {/* GTM Script - Solo si existe ID */}
    { GTM_ID && (
      <script is:inline define:vars={{ GTM_ID }}>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer',GTM_ID);
      </script>
    )}

    <script is:inline>
      const getTheme = () => {
        if (
          typeof localStorage !== "undefined" &&
          localStorage.getItem("theme")
        ) {
          return localStorage.getItem("theme");
        }
        return window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "light";
      };
      document.documentElement.setAttribute("data-theme", getTheme());

      // Zutra: Random Accent Color Initialization
      (function() {
        const palettes = [
          { main: '#EFD319', hover: '#FACC15', onAccent: '#080501' }, // Amarillo
          { main: '#19EFB5', hover: '#15C999', onAccent: '#080501' }, // Verde Menta
          { main: '#FF0055', hover: '#D6004C', onAccent: '#ffffff' }, // Magenta
          { main: '#811DBC', hover: '#6A169E', onAccent: '#ffffff' }  // PÃºrpura
        ];
        const randomPalette = palettes[Math.floor(Math.random() * palettes.length)];
        const root = document.documentElement;
        
        root.style.setProperty('--accent-main', randomPalette.main);
        root.style.setProperty('--accent-hover', randomPalette.hover);
        root.style.setProperty('--color-accent', randomPalette.main);
        root.style.setProperty('--color-accent-hover', randomPalette.hover);
        root.style.setProperty('--color-on-accent', randomPalette.onAccent);
        
        const r = parseInt(randomPalette.main.slice(1, 3), 16);
        const g = parseInt(randomPalette.main.slice(3, 5), 16);
        const b = parseInt(randomPalette.main.slice(5, 7), 16);
        root.style.setProperty('--color-accent-rgb', `${r}, ${g}, ${b}`);
        
        console.log('Zutra: Accent color initialized in head:', randomPalette.main);
        window.__ZUTRA_ACCENT__ = randomPalette.main;
      })();
    </script>

    <link
      rel="icon"
      id="dynamic-favicon"
      href="/favicon.svg"
      type="image/svg+xml"
    />

    <link rel="stylesheet" href="https://use.typekit.net/dmw4nxz.css" />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <!-- GTM NoScript -->
    { GTM_ID && (
      <noscript><iframe src={`https://www.googletagmanager.com/ns.html?id=${GTM_ID}`}
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    )}

    <slot />
    
    <div id="bg-master" class="bg-master">
      <div class="bg-layer topo-layer"></div>
      <div class="bg-layer topo-layer-2"></div>
    </div>

    <CookieConsent />
    <PreviewIndicator />

    {isPreviewEnabled && (
      <script>
        import { ContentfulLivePreview } from '@contentful/live-preview';
        
        ContentfulLivePreview.init({
          locale: 'es-US',
          enableInspectorMode: true,
          enableLiveUpdates: true,
        });
      </script>
    )}

    <script>
      import "../scripts/main.js";
    </script>
  </body>
</html>
