---
import { getEntries } from "@/lib/contentful";
import { adaptCategory } from "@/lib/contentful-adapters";

// Fetch categories from Contentful
const entries = await getEntries("category", {
    order: "fields.order",
});
const categories = entries.items.map(adaptCategory);
---

<div class="blog-controls">
    <div class="search-box">
        <i class="ph-duotone ph-magnifying-glass search-icon"></i>
        <input
            type="text"
            id="blog-search"
            placeholder="Buscar artÃ­culos valientes..."
            class="search-input"
        />
    </div>

    <div class="category-filters">
        <a href="/blog" class="filter-chip active">Todos</a>
        {
            categories.map((cat) => (
                <a href={`/blog/category/${cat.id}`} class="filter-chip">
                    {cat.label}
                </a>
            ))
        }
    </div>
</div>

<style>
    .blog-controls {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        margin-bottom: 4rem;
    }

    .search-box {
        position: relative;
        max-width: 40rem;
        width: 100%;
        margin: 0 auto;
    }

    .search-icon {
        position: absolute;
        left: 1.25rem;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.25rem;
        color: var(--color-muted);
        pointer-events: none;
    }

    .search-input {
        width: 100%;
        background: var(--color-subtle);
        border: 1px solid var(--color-line);
        border-radius: var(--radius-full);
        padding: 1rem 1.25rem 1rem 3.25rem;
        color: var(--color-secondary);
        font-size: 1.1rem;
        transition: all 0.3s ease;
    }

    .search-input:focus {
        outline: none;
        border-color: var(--color-accent);
        background: var(--color-surface);
    }

    .category-filters {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.75rem;
    }

    .filter-chip {
        padding: 0.6rem 1.5rem;
        border-radius: var(--radius-full);
        background: var(--color-subtle);
        border: 1px solid var(--color-line);
        color: var(--color-muted);
        font-size: 0.95rem;
        font-weight: 700;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .filter-chip:hover {
        border-color: var(--color-accent);
        color: var(--color-secondary);
    }

    .filter-chip.active {
        background: var(--color-accent);
        border-color: var(--color-accent);
        color: var(--color-on-accent, #000);
    }

    @media (max-width: 640px) {
        .category-filters {
            justify-content: flex-start;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            scrollbar-width: none;
        }
        .category-filters::-webkit-scrollbar {
            display: none;
        }
        .filter-chip {
            white-space: nowrap;
        }
    }
</style>
